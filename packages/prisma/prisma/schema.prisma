generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model User {
  id         String     @id @default(uuid())
  email      String     @unique
  password   String
  firstName  String
  lastName   String
  phone      String     @unique
  role       Role       @default(SEEKER)
  isVerified Boolean    @default(false)
  otp        Int?
  createdAt  DateTime   @default(now())
  updatedAt  DateTime   @updatedAt
  wishlist   Wishlist[]

  @@index([email])
  @@index([phone])
  @@index([role])
}

model Owner {
  id         String     @id @default(uuid())
  email      String     @unique
  password   String
  firstName  String
  lastName   String
  phone      String     @unique
  isVerified Boolean    @default(false)
  otp        Int?
  planType   String?    @default("FREE")
  validity   DateTime   @default(now())
  listings   Int?       @default(1)
  createdAt  DateTime   @default(now())
  updatedAt  DateTime   @updatedAt
  properties Property[]

  @@index([email])
  @@index([phone])
}

model Admin {
  id            String                 @id @default(uuid())
  email         String                 @unique
  password      String
  firstName     String
  lastName      String
  phone         String                 @unique
  role          AdminRole              @default(EMPLOYEE)
  isActive      Boolean                @default(true)
  createdAt     DateTime               @default(now())
  updatedAt     DateTime               @updatedAt
  lastLogin     DateTime?
  assignedBy    String?
  activityLogs  AdminActivityLog[]
  permissions   EmployeePermission?
  verifications PropertyVerification[]

  @@index([email])
  @@index([role])
  @@index([isActive])
}

model EmployeePermission {
  id                  String   @id @default(uuid())
  adminId             String   @unique
  canViewUsers        Boolean  @default(false)
  canViewOwners       Boolean  @default(false)
  canViewProperties   Boolean  @default(false)
  canEditProperties   Boolean  @default(false)
  canVerifyProperties Boolean  @default(false)
  canHandleUsers      Boolean  @default(false)
  canHandleOwners     Boolean  @default(false)
  canViewDashboard    Boolean  @default(true)
  canViewReports      Boolean  @default(false)
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt
  admin               Admin    @relation(fields: [adminId], references: [id], onDelete: Cascade)

  @@index([adminId])
}

model AdminActivityLog {
  id         String   @id @default(uuid())
  adminId    String
  action     String
  entityType String
  entityId   String?
  details    String?
  createdAt  DateTime @default(now())
  admin      Admin    @relation(fields: [adminId], references: [id], onDelete: Cascade)

  @@index([adminId])
  @@index([createdAt])
  @@index([entityType])
}

model Property {
  id                   String                 @id @default(uuid())
  title                String
  description          String
  propertyType         PropertyType
  address              String
  city                 String
  townSector           String?
  colony               String?
  landmark             String?
  latitude             Float?
  longitude            Float?
  apiAddress           String?
  rent                 String?
  security             String?                @default("0")
  maintenance          String?                @default("0")
  negotiable           Boolean                @default(false)
  bhk                  Int                    @default(1)
  furnished            String
  accommodation        String?
  totalFloors          Int                    @default(1)
  totalUnits           Int                    @default(1)
  powerBackup          String
  waterSupply          String
  parking              String
  insideAmenities      String[]
  outsideAmenities     String[]
  genderPreference     String?
  preferredTenants     String[]
  noticePeriod         String?
  contactName          String
  whatsappNo           String
  images               String[]
  isAvailable          Boolean                @default(true)
  isVerified           Boolean                @default(false)
  isDraft              Boolean                @default(false)
  views                Int                    @default(0)
  contactCount         Int                    @default(0)
  ownerId              String
  createdAt            DateTime               @default(now())
  updatedAt            DateTime               @updatedAt
  expiry               DateTime?
  offer                String?                @default("")
  type                 String?                @default("RENT")
  verificationExpiry   DateTime?
  verificationStatus   VerificationStatus     @default(NOT_VERIFIED)
  verifiedAt           DateTime?
  builtUpArea          String?
  carpetArea           String?
  facingDirection      String?
  floorNumber          Int?
  furnishingDetails    String?
  listingType          String                 @default("RENT")
  possession           String?
  pricePerSqft         String?
  propertyAge          String?
  salePrice            String?
  contacts             Contact[]
  owner                Owner                  @relation(fields: [ownerId], references: [id], onDelete: Cascade)
  verifications        PropertyVerification[]
  verificationRequests VerificationRequest[]
  wishlist             Wishlist[]

  @@index([city])
  @@index([propertyType])
  @@index([listingType])
  @@index([ownerId])
  @@index([isAvailable])
  @@index([isDraft])
  @@index([createdAt])
  @@index([verificationStatus])
}

model VerificationRequest {
  id                    String                    @id @default(uuid())
  propertyId            String
  ownerId               String
  amount                Int                       @default(299)
  paymentStatus         String                    @default("PENDING")
  paymentId             String?
  paymentDate           DateTime?
  status                VerificationRequestStatus @default(PENDING_PAYMENT)
  reviewedBy            String?
  reviewedAt            DateTime?
  reviewNotes           String?
  validFrom             DateTime?
  validUntil            DateTime?
  createdAt             DateTime                  @default(now())
  updatedAt             DateTime                  @updatedAt
  assignedAt            DateTime?
  assignedTo            String?
  propertyCity          String
  verificationPhotos    String[]                  @default([])
  locationCapturedAt    DateTime?
  verificationAddress   String?
  verificationLatitude  Float?
  verificationLongitude Float?
  property              Property                  @relation(fields: [propertyId], references: [id], onDelete: Cascade)

  @@index([propertyId])
  @@index([ownerId])
  @@index([status])
  @@index([paymentStatus])
  @@index([propertyCity])
  @@index([assignedTo])
  @@index([createdAt])
}

model PropertyVerification {
  id                 String   @id @default(uuid())
  propertyId         String
  verifiedBy         String
  verificationPhotos String[]
  verificationNotes  String?
  verifiedAt         DateTime @default(now())
  validUntil         DateTime
  isActive           Boolean  @default(true)
  property           Property @relation(fields: [propertyId], references: [id], onDelete: Cascade)
  employee           Admin    @relation(fields: [verifiedBy], references: [id])

  @@index([propertyId])
  @@index([verifiedBy])
  @@index([verifiedAt])
  @@index([validUntil])
  @@index([isActive])
}

model Contact {
  id           String        @id @default(uuid())
  propertyId   String
  userName     String
  userPhone    String
  message      String?
  contactType  ContactType   @default(INQUIRY)
  status       ContactStatus @default(NEW)
  ownerDeleted Boolean       @default(false)
  userDeleted  Boolean       @default(false)
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  property     Property      @relation(fields: [propertyId], references: [id], onDelete: Cascade)

  @@index([propertyId])
  @@index([userPhone])
  @@index([createdAt])
}

model Wishlist {
  id         String   @id @default(uuid())
  userId     String
  propertyId String
  createdAt  DateTime @default(now())
  property   Property @relation(fields: [propertyId], references: [id], onDelete: Cascade)
  user       User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, propertyId])
  @@index([userId])
  @@index([propertyId])
}

model TempMobileVerification {
  id        String   @id @default(uuid())
  mobile    String   @unique
  otp       Int
  expiresAt DateTime
  verified  Boolean  @default(false)
  createdAt DateTime @default(now())

  @@index([mobile])
  @@index([expiresAt])
}

model ContactUs {
  id        String   @id @default(cuid())
  name      String
  email     String   @unique
  message   String
  phone     String
  createdAt DateTime @default(now())
}

model RentAgreement {
  id                     String    @id @default(uuid())
  createdBy              String
  creatorPhone           String
  creatorUserId          String?
  ownerFullName          String
  ownerPhone             String
  ownerAddress           String
  tenantFullName         String
  tenantPhone            String
  tenantPermanentAddress String
  propertyAddress        String
  annexures              String?
  rentAmount             String
  securityDeposit        String
  agreementDuration      String
  noticePeriod           String
  rentStartDate          DateTime
  paymentStatus          String    @default("PENDING")
  paymentAmount          String?
  paymentDate            DateTime?
  paymentId              String?
  documentGenerated      Boolean   @default(false)
  documentUrl            String?
  createdAt              DateTime  @default(now())
  updatedAt              DateTime  @updatedAt
  ownerEmail             String?
  tenantEmail            String?

  @@index([creatorPhone])
  @@index([creatorUserId])
  @@index([ownerPhone])
  @@index([tenantPhone])
  @@index([createdAt])
  @@index([paymentStatus])
}

enum Role {
  SEEKER
  OWNER
  ADMIN
}

enum AdminRole {
  MAIN_ADMIN
  EMPLOYEE
}

enum PropertyType {
  ROOM
  PG
  FLAT
  PLOT
  HOUSE
  VILLA
}

enum VerificationStatus {
  NOT_VERIFIED
  PENDING_PAYMENT
  PENDING_VERIFICATION
  VERIFIED
  EXPIRED
}

enum VerificationRequestStatus {
  PENDING_PAYMENT
  PAYMENT_COMPLETED
  UNDER_REVIEW
  APPROVED
  REJECTED
  EXPIRED
}

enum ContactType {
  INQUIRY
  CALL_REQUEST
  WHATSAPP
}

enum ContactStatus {
  NEW
  CONTACTED
  CLOSED
}
